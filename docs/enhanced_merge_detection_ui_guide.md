# 增强Merge检测 - UI配置使用指南

## 🎛️ UI界面配置功能

AI-CodeReview 现已支持通过Web UI界面配置增强Merge检测功能，无需手动编辑配置文件。

## 📋 功能特点

### 🖥️ 可视化配置
- ✅ **图形化界面**：通过滑动条和复选框配置
- ✅ **实时预览**：配置变更立即显示效果
- ✅ **智能提示**：提供配置建议和说明
- ✅ **参数验证**：自动验证配置值的有效性

### ⚙️ 精确控制
- ✅ **精细调节**：支持0.05步长的阈值调节（如0.45）
- ✅ **模式显示**：自动显示当前检测模式（宽松/平衡/严格）
- ✅ **详细说明**：展开式的功能说明和使用建议

## 🚀 使用步骤

### 1. 访问配置界面

1. 启动UI服务：
   ```bash
   python ui.py
   ```

2. 打开浏览器访问：`http://localhost:5002`

3. 进入"系统配置"页面

### 2. 找到增强Merge检测配置

在"🏛️ 代码仓库配置"展开面板中找到：

```
### 📂 SVN仓库配置
#### 🔍 增强Merge检测配置
```

### 3. 配置参数

#### 启用增强检测
- ☑️ **启用增强Merge检测**
- 描述：启用多维度merge检测算法，相比传统基于消息的检测，准确率更高

#### 调节置信度阈值
- **检测置信度阈值**：滑动条 0.1 - 1.0（步长0.05）
- **默认值**：0.45
- **推荐范围**：0.4-0.5

#### 检测模式显示
根据阈值设置，界面会自动显示当前模式：
- 🔍 **宽松模式**（≤0.4）
- ⚖️ **平衡模式**（0.4-0.5）
- 🎯 **严格模式**（>0.5）

### 4. 查看详细说明

点击"ℹ️ 增强检测说明"展开面板可查看：
- 功能特点
- 检测维度说明
- 阈值建议

### 5. 保存配置

点击"💾 保存系统配置"按钮保存所有更改。

## 🔧 配置选项详解

### 阈值配置建议

| 阈值范围 | 模式 | 特点 | 适用场景 |
|---------|------|------|----------|
| 0.3-0.4 | 宽松 | 检测更多可能的merge | 希望不遗漏任何merge提交 |
| 0.4-0.5 | 平衡 | 准确性和覆盖率平衡 | **推荐使用**，适合大多数场景 |
| 0.5-0.7 | 严格 | 只检测明确的merge | 减少误检，只处理确定的merge |

### 精确阈值设置

UI支持0.05步长调节，可以设置：
- `0.40`, `0.45`, `0.50`, `0.55`, `0.60` 等

推荐从 **0.45** 开始，根据实际效果调整：
- 如果漏检较多 → 降到 `0.40` 或 `0.35`
- 如果误检较多 → 升到 `0.50` 或 `0.55`

## 📊 配置效果监控

### 通过UI查看配置状态

在"系统配置"→"配置概览"页面可以看到：

```
📂 SVN配置
├── USE_ENHANCED_MERGE_DETECTION: ✅ 已配置
├── MERGE_DETECTION_THRESHOLD: ✅ 已配置
└── SVN_REPOSITORIES: ✅ 已配置
```

### 通过日志监控效果

应用运行时会在日志中记录：
```
增强检测识别为merge提交 (置信度: 0.65, 方法: message, paths, stats)
```

## 🔄 配置生效

配置保存后需要**重启应用服务**才能生效：

```bash
# 停止服务
pkill -f "python.*api.py"

# 重新启动
python api.py &
```

## 🧪 测试配置效果

可以运行测试脚本验证配置：

```bash
python test_threshold_045.py
```

输出示例：
```
🧪 测试增强Merge检测 - 阈值0.45
============================================================
当前配置: 增强检测=True, 阈值=0.45

测试场景                置信度      检测结果    预期    状态
------------------------------------------------------------
明确的merge消息           0.55       是        是      ✅
隐式大型merge            0.45       是        是      ✅
同步更新                 0.45       是        是      ✅
普通bugfix             0.25       否        否      ✅

🎉 所有测试通过！阈值0.45工作正常
```

## 💡 最佳实践

1. **初始配置**：
   - 启用增强检测
   - 设置阈值为 0.45
   - 保存并重启服务

2. **监控期**（1-2周）：
   - 观察日志中的检测结果
   - 统计误检和漏检情况

3. **调优**：
   - 根据监控结果微调阈值
   - 每次调整0.05步长
   - 重新监控验证效果

4. **稳定运行**：
   - 找到最佳阈值后保持配置
   - 定期检查检测效果
   - 根据代码库变化适时调整

## 🚨 注意事项

1. **配置变更**：修改配置后必须重启服务
2. **阈值范围**：建议在0.3-0.7范围内调整
3. **监控反馈**：定期查看检测效果，及时调优
4. **备份配置**：重要配置建议备份保存

---

*最后更新：2025-07-03*
*版本：v1.1 - 支持UI配置*
